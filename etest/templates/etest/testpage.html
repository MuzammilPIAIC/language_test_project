{%extends 'base.html'%}

{%block body%}


<div class="container">
    <h1>Question No 1</h1>
    {% csrf_token %}
    <button id="startButton">Start Recording</button>
    <button id="stopButton">Stop Recording</button>
    <span id="status"></span>

</div>

<script>

    let mediaRecorder;

    const startRecording = () => {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      const chunks = []; // Clear the previous recording chunks

      mediaRecorder.addEventListener('dataavailable', event => {
        chunks.push(event.data);
      });

      mediaRecorder.addEventListener('stop', () => {
        const blob = new Blob(chunks, { type: 'audio/mp3' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'recording.mp3';
        a.click();
        chunks.length = 0; // Clear the chunks after creating the download link

        const formData = new FormData();
        formData.append('audio', blob);

        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'audio_file' %}", {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrfToken
          },
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            // Process the API response
            document.getElementById('status').textContent = data.message;
          })
          .catch(error => {
            console.error('Error sending recording:', error);
          });
      });

      mediaRecorder.start();
      console.log('Voice recording started...');
    })
    .catch(error => {
      console.error('Error accessing microphone:', error);
    });
};

const stopRecording = () => {
    mediaRecorder.stop();
    console.log('Voice recording stopped...');
};

document.getElementById('startButton').addEventListener('click', startRecording);
document.getElementById('stopButton').addEventListener('click', stopRecording);














    //      let mediaRecorder;
    // let chunks = [];

    // const startRecording = () => {
    //   navigator.mediaDevices.getUserMedia({ audio: true })
    //     .then(stream => {
    //       mediaRecorder = new MediaRecorder(stream);
    //       mediaRecorder.start();
    //       console.log('voice recording started>>>>>>>>>>>>')

    //       mediaRecorder.addEventListener('dataavailable', event => {
    //         chunks.push(event.data);
    //       });
    //     })
    //     .catch(error => {
    //       console.error('Error accessing microphone:', error);
    //     });
    // };

    // const stopRecording = () => {
    //   mediaRecorder.stop();
    //   console.log('voice recording stopped >>>>>>>>>>>>')
    // };

    // const sendRecording = () => {
    //   const blob = new Blob(chunks, { type: 'audio/mp3' });
    //   const url = URL.createObjectURL(blob);
    //   const a = document.createElement('a');
    //   a.href = url;
    //   a.download = 'recording.mp3';
    //   a.click();
    //   chunks = [];

    //   const formData = new FormData();
    //   formData.append('audio', blob);

//     fetch('your-api-url', {
//         method: 'POST',
//         body: formData
//     })
//         .then(response => response.json())
//         .then(data => {
//             // Process the API response
//             document.getElementById('status').textContent = data.message;
//         })
//         .catch(error => {
//             console.error('Error sending recording:', error);
//         });
// // };

// document.getElementById('startButton').addEventListener('click', startRecording);
// document.getElementById('stopButton').addEventListener('click', stopRecording);
// // document.getElementById('stopButton').addEventListener('click', sendRecording);
</script>
</script>


{%endblock%}